<style>
    .alert {
        display: none;
    }
</style>
<!-------------------------------- Get all data  ------------------------------ -->
<div class="container-fluid">
    <div class="page-title-box">
        <div class="row align-items-center">
            <div class="col-sm-9">
                <h4 class="page-title">Slider table</h4>
            </div>
            <div class="col-sm-3">
                <button type="button" class="btn btn-outline-warning waves-effect waves-light" data-toggle="modal"
                    data-target="#kino_create_modal"> <i class="fas fa-plus-square"></i> Movie slider</button>
                <button type="button" class="btn btn-outline-warning waves-effect waves-light" data-toggle="modal"
                    data-target="#season_create_modal"> <i class="fas fa-plus-square"></i> Season slider</button>
            </div>

        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="card m-b-30">
                <div class="alert alert-warning" role="alert" id="delete_success">
                    Malumot muvaffaquyatli o'chirildi
                </div>
                <div class="card-body">
                    <table id="datatable" class="table table-bordered dt-responsive nowrap text-center"
                        style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                        <thead>
                            <tr>
                               
                                <th>Slider name</th>
                                <th>Date</th>
                                <th style="width: 30%;">Setting</th>
                            </tr>
                        </thead>
                        <tbody class="GET_ALL_DATAS">

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


<!------------------------------   Create Kino Slidel Modal  -------------------------------->
<div class="modal fade bs-example-modal-xl" id="kino_create_modal" tabindex="-1" role="dialog"
    aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mt-0" id="myLargeModalLabel">Create Movie slider</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning" role="alert" id="error_kino_slider">
                    Iltimos malumotni to'liq kiriting
                </div>
                <div class="alert alert-success" role="alert" id="success_kino_slider">
                    Muvaffaquyatli yaratildi
                </div>


                <div class="mb-3">
                    <label for="">Enter movie</label>
                    <select class="form-control COUNTRY" value="" id="KINO">

                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Enter title</label>
                    <input type="text" class="form-control" id="TITLE_KINO">
                </div>
                <div class="mb-3">
                    <label class="form-label">Enter description</label>
                    <textarea class="form-control" id="DESCRIPTION_KINO" cols="30" rows="10"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Enter image</label>
                    <input type="file" class="form-control" id="IMAGE_SLIDER_KINO">
                </div>



                <div class="mb-3">
                    <button onclick="createKinoSlider()" class="btn btn-outline-warning"> <i
                            class="fas fa-plus-square"></i>Save data</button>
                </div>
            </div>
        </div>
    </div>
</div>


<!------------------------------   Create Season Slider  Modal  -------------------------------->
<div class="modal fade bs-example-modal-xl" id="season_create_modal" tabindex="-1" role="dialog"
    aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mt-0" id="myLargeModalLabel">Create Season slider</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning" role="alert" id="error_season_slider">
                    Iltimos malumotni to'liq kiriting
                </div>
                <div class="alert alert-success" role="alert" id="success_season_slider">
                    Muvaffaquyatli yaratildi
                </div>

                <div class="mb-3">
                    <label for="">Enter season</label>
                    <select class="form-control COUNTRY" value="" id="SEASON">

                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Enter title</label>
                    <input type="text" class="form-control" id="TITLE_SEASON">
                </div>
                <div class="mb-3">
                    <label class="form-label">Enter description</label>
                    <textarea class="form-control" id="DESCRIPTION_SEASON" cols="30" rows="10"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Enter image</label>
                    <input type="file" class="form-control" id="IMAGE_SLIDER_SEASON">
                </div>




                <div class="mb-3">
                    <button onclick="createSeasonSlider()" class="btn btn-outline-warning"> <i
                            class="fas fa-plus-square"></i> Save data</button>
                </div>
            </div>
        </div>
    </div>
</div>






<!------------------------------   Information Modal  -------------------------------->
<div class="modal fade bs-example-modal-xl" id="get_item_modal" tabindex="-1" role="dialog"
    aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mt-0" id="myLargeModalLabel">View existed data</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body get_item_modal_DATA">

            </div>
        </div>
    </div>
</div>
<!------------------------------   Update Text  -------------------------------->
<div class="modal fade bs-example-modal-xl" id="update_item_modal" tabindex="-1" role="dialog"
    aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mt-0" id="myLargeModalLabel">Update Data</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body update_item_modal_DATA"></div>
        </div>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/axios.min.js"></script>
<script>


    // Kino uchun slider yaratish
    axios.get('/api/kino/all').then(async (Response) => {
        const result = Response.data
        const get_DATA = $('#KINO')
        await get_DATA.html("")
        get_DATA.append(`<option value="" style="font-weight: 900;"> Select something </option>`)
        result.forEach((item, index) => {
            get_DATA.append(`<option value="${item._id}">${item.name}</option>`)
        });
    })
    const createKinoSlider = () => {
        const formData = new FormData()

        const error_kino_slider = document.getElementById('error_kino_slider')
        const success_kino_slider = document.getElementById('success_kino_slider')

        const KINO = document.getElementById('KINO').value
        const TITLE_KINO = document.getElementById('TITLE_KINO').value
        const DESCRIPTION_KINO = document.getElementById('DESCRIPTION_KINO').value
        const IMAGE_SLIDER_KINO = document.getElementById('IMAGE_SLIDER_KINO').files[0]

        formData.append('image', IMAGE_SLIDER_KINO)
        formData.append('title', TITLE_KINO)
        formData.append('description', DESCRIPTION_KINO)
        formData.append('kino', KINO)



        if (
            KINO == "" ||
            TITLE_KINO == "" ||
            DESCRIPTION_KINO == "" ||
            IMAGE_SLIDER_KINO == ""
        ) {
            error_kino_slider.style.display = "block"
            setTimeout(() => {
                error_kino_slider.style.display = "none"
            }, 2000)
        } else {

            axios({
                url: '/api/slider/kino',
                method: "POST",
                data: formData,
                headers: {
                    "Content-Type": "multipart/form-data"
                }
            })
                .then((res) => {
                    success_kino_slider.style.display = "block"
                    setTimeout(() => {
                        window.location.reload()
                    }, 2000)
                })
        }

    }
    // Season uchun slider yaratish 
    axios.get('/api/season/all').then(async (Response) => {
        const result = Response.data
        const get_DATA = $('#SEASON')
        await get_DATA.html("")
        get_DATA.append(`<option value="" style="font-weight: 900;"> Select something </option>`)
        result.forEach((item, index) => {
            get_DATA.append(`<option value="${item._id}">${item.name}</option>`)
        });
    })
    const createSeasonSlider = () => {
        const formData = new FormData()

        const error_season_slider = document.getElementById('error_season_slider')
        const success_season_slider = document.getElementById('success_season_slider')


        const SEASON = document.getElementById('SEASON').value
        const TITLE_SEASON = document.getElementById('TITLE_SEASON').value
        const DESCRIPTION_SEASON = document.getElementById('DESCRIPTION_SEASON').value
        const IMAGE_SLIDER_SEASON = document.getElementById('IMAGE_SLIDER_SEASON').files[0]

        formData.append('image', IMAGE_SLIDER_SEASON)
        formData.append('title', TITLE_SEASON)
        formData.append('description', DESCRIPTION_SEASON)
        formData.append('season', SEASON)



        if (
            SEASON == "" ||
            TITLE_SEASON == "" ||
            DESCRIPTION_SEASON == "" ||
            IMAGE_SLIDER_SEASON == ""
        ) {
            error_season_slider.style.display = "block"
            setTimeout(() => {
                error_season_slider.style.display = "none"
            }, 2000)
        } else {

            axios({
                url: '/api/slider/season',
                method: "POST",
                data: formData,
                headers: {
                    "Content-Type": "multipart/form-data"
                }
            })
                .then((res) => {
                    success_season_slider.style.display = "block"
                    setTimeout(() => {
                        window.location.reload()
                    }, 2000)
                })
        }

    }



    // Hamma sliderlarni tablega qoyish 
    axios.get('/api/slider/all').then(async (Response) => {
        const result = Response.data // [{}, {}, {}]
        console.log(result)
        const get_DATA = $('.GET_ALL_DATAS')
        await get_DATA.html("")
        result.forEach((item, index) => {
            get_DATA.append(`
                <tr>
                    <td>${item.title}</td>
                    <td>${new Date(item.createdAt).toLocaleDateString()}</td>
                    <td>
                        <button onclick="getITEM('${item._id}')" class="btn btn-outline-success" data-toggle="modal" data-target="#get_item_modal">
                            <i class="far fa-eye"></i> 
                        </button>

                        <button onclick="updateITEM('${item._id}')" class="btn btn-outline-warning" data-toggle="modal"  data-target="#update_item_modal">
                            <i class="fas fa-eye-dropper"></i>
                        </button>

                        <button onclick="deleteITEM('${item._id}')" class="btn btn-outline-danger">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>
            `)
        });
    })


    // Bitta malumotni korish uchun
    const getITEM = (id) => {
        axios.get(`/api/slider/${id}`).then(async (Response) => {
            const result = Response.data // {}
            const get_DATA = $('.get_item_modal_DATA')
            await get_DATA.html("")
            get_DATA.append(`
                <ul class="col-sm-12 list-group list-group-horizontal">
                    <li class=" font-14 bg-warning text-dark list-group-item col-sm-6">Slider sarlavhasi ?</li>
                    <li class=" font-14 text-warning list-group-item col-sm-6">${result.title}</li>
                </ul>
                <ul class="col-sm-12 list-group list-group-horizontal mt-2">
                    <li class=" font-14 bg-warning text-dark list-group-item col-sm-6"> Slider nima haqida ?</li>
                    <li class=" font-14 text-warning list-group-item col-sm-6">${result.description}</li>
                </ul>
                <ul class="col-sm-12 list-group list-group-horizontal mt-2">
                    <li class=" font-14 bg-warning text-dark list-group-item col-sm-6"> Slider uchun rasm ?</li>
                    <li class=" font-14 text-warning list-group-item col-sm-6">
                        <img style="width: 300px;" src="/uploads/${result.file}" alt="">
                    </li>
                </ul>
            `)


        })
    }


    // Sliderni tahrirlash
    const updateITEM = (id) => {
        axios.get(`/api/slider/${id}`).then(async (Response) => {
            const result = Response.data // [{}, {}, {}]
            const get_DATA = $('.update_item_modal_DATA')
            await get_DATA.html("")
            get_DATA.append(`
            
                <div class="alert alert-warning" role="alert" id="error_update">
                    Iltimos malumotni to'liq kiriting
                </div>
                <div class="alert alert-success" role="alert" id="success_update">
                    Muvaffaquyatli tahrirlandi
                </div>

                <div class="mb-3">
                    <label class="form-label">Enter name</label>
                    <input type="text" value="${result.title}" class="form-control " id="UPDATE__NAME">
                </div>
                <div class="mb-3">
                    <label class="form-label">Enter description</label>
                    <textarea class="form-control"  id="UPDATE__DESCRIPTION" cols="30" rows="10">${result.description}</textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Enter image</label>
                    <input type="file" class="form-control" id="UPDATE__IMAGE">
                </div>
               
                <div class="mb-3">
                    <button onclick="updateAction('${result._id}')" class="btn btn-outline-warning"> <i class="fas fa-plus-square"></i>
                        Save data</button>
                </div>
            
            `)
        })
    }
    const updateAction = (id) => {
        const formData = new FormData()

        let IMAGE = document.getElementById("UPDATE__IMAGE").files[0]
        let NAME = $("#UPDATE__NAME").val()
        let DESCRIPTION = $("#UPDATE__DESCRIPTION").val()

        formData.append("image", IMAGE)
        formData.append("title", NAME)
        formData.append("description", DESCRIPTION)

        if (
            IMAGE == "" ||
            NAME == "" ||
            DESCRIPTION == ""
        ) {
            document.getElementById('error_update').style.display = "block"
            setTimeout(() => { document.getElementById('error_update').style.display = "none" }, 3000)
        } else {
            axios({
                url: `/api/slider/${id}`,
                method: "PUT",
                data: formData,
                headers: {
                    "Content-Type": "multipart/form-data"
                }
            }).then((res) => {
                document.getElementById('success_update').style.display = "block"
                setTimeout(() => {
                    window.location.reload()
                }, 2000)
            }).catch((error) => {
                console.log(error)
            })
        }
    }


     // Sliderni o'chirish
     const deleteITEM = (id) => {
        axios.delete(`/api/slider/${id}`).then((res) => {
            document.getElementById('delete_success').style.display = "block"
            setTimeout(() => {
                window.location.reload()
            }, 2000)
        })
    }

</script>