<style>
    .alert {
        display: none;
    }
</style>

<div class="banner-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="banner-wrap justify-content-between align-items-center">
                    <div class="left-wrap">
                        <span class="rnd" id="imdb"></span>
                        <h2 id="name"></h2>

                        <span class="tag"><b id="hd"></b></span>
                        <span class="tag"><b id="age"></b></span>
                        <span id="times" class="tag"></span>
                        <span class="tag" id="views"> </span>
                        <span class="tag" id="like"> </span>
                        <span class="tag" id="dislike"> </span>
                        <a id="watching" href="" class="btn btn-lg mt-3"><img src="/images/play.png" alt="icn">Tomoshaqilish</a>
                        <a href=""  class="icon-bttn" id="rating">

                        </a>
                    </div>
                    <div class="right-wrap" id="images"></div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Qoshimcha malumotlar uchun  -->
<div class="page-nav">
    <div class="container">
        <div class="row">
            <div class="col-sm-12 text-center">
                <h2 class="mb-1">Qo'shimcha malumotlar</h2>
            </div>
        </div>
    </div>
</div>
<div class="faq-page">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-12">
                <div id="accordion" class="accordion">

                    <div class="card">
                        <div class="card-header" id="headingOne">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseOne"
                                    aria-expanded="false" aria-controls="collapseOne">
                                    Qaysi davlatlar tomonidan ishlab chiqarilgan ?
                                </button>
                            </h5>
                        </div>
                        <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                            <div class="card-body">
                                <ul id="country">

                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingTwo">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo"
                                    aria-expanded="false" aria-controls="collapseTwo">
                                    Kino haqida qisqacha malumot ?
                                </button>
                            </h5>
                        </div>
                        <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                            <div class="card-body">
                                <p id="description"></p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingThree">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse"
                                    data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    Qaysi janrlaga tegishli ?
                                </button>
                            </h5>
                        </div>
                        <div id="collapseThree" class="collapse" aria-labelledby="headingThree"
                            data-parent="#accordion">
                            <div class="card-body">
                                <ul id="janr">

                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingFour">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse"
                                    data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                    Qaysi tillarga tarjima qilingan ?
                                </button>
                            </h5>
                        </div>
                        <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">
                            <div class="card-body">
                                <ul id="language">

                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingFive">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse"
                                    data-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                    Qaysi kategoriyalarga tegishli?
                                </button>
                            </h5>
                        </div>
                        <div id="collapseFive" class="collapse" aria-labelledby="headingFive" data-parent="#accordion">
                            <div class="card-body">
                                <ul id="category">

                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingSix">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseSix"
                                    aria-expanded="false" aria-controls="collapseSix">
                                    Qaysi rejissiorlar tomonidan suratga olingan
                                </button>
                            </h5>
                        </div>
                        <div id="collapseSix" class="collapse" aria-labelledby="headingSix" data-parent="#accordion">
                            <div class="card-body">
                                <ul id="author">

                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingSeven">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse"
                                    data-target="#collapseSeven" aria-expanded="false" aria-controls="collapseSeven">
                                    Qaysi teglar orqali izlash mumkin ?
                                </button>
                            </h5>
                        </div>
                        <div id="collapseSeven" class="collapse" aria-labelledby="headingSeven"
                            data-parent="#accordion">
                            <div class="card-body">
                                <ul id="tag">

                                </ul>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>













<!-- Komentariya uchun -->
<div class="page-nav">
    <div class="container">
        <div class="row">
            <div class="col-sm-12 text-center">
                <h2 class="mb-1">Komentariya qoldirish</h2>
            </div>
        </div>
    </div>
</div>


<div class="faq-page">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-8">
                <div id="accordion" class="accordion">
                    <div class="card mb-3">
                        <div class="card-header" id="headingComment">
                            <h5 class="mb-0">
                                <button class="btn btn-link small-text collapsed pl-5 text-left" data-toggle="collapse"
                                    data-target="#collapseComment" aria-expanded="false"
                                    aria-controls="collapseComment">
                                    <i class="ti-user"></i>Shu yerga koment yozing <span> Fikrlaringizni izohlang</span>
                                </button>
                            </h5>
                        </div>
                        <div id="collapseComment" class="collapse" aria-labelledby="headingComment"
                            data-parent="#accordion">
                            <div class="card-body form-div">
                                <form action="#">


                                    <div class="alert alert-warning" role="alert" id="error_create">
                                        Iltimos malumotni to'liq kiriting
                                    </div>
                                    <div class="alert alert-success" role="alert" id="success_create">
                                        Muvaffaquyatli yaratildi
                                    </div>


                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group mt-0">
                                                <input type="text" style="color: black" class="form-control"
                                                    id="username" placeholder="Ismingizni qoldiring">
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="form-group mt-0">
                                                <textarea style="color: black" class="form-control"
                                                    placeholder="Komment qoldiring" id="message" cols="30"
                                                    rows="30"></textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group button-block text-center">
                                        <a onclick="sendComment()" style="cursor: pointer;" class="form-btn member-bttn3 text-white d-block">Saqlash</a>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




<div class="faq-page">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-12">
                <div id="accordion" class="accordion allComment">

                </div>
            </div>
        </div>
    </div>
</div>








<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/axios.min.js"></script>
<script>

    const path = window.location.pathname
    const id = path.slice(7)


    axios.get(`/api/kino/${id}`).then(async (res) => {
        const result = res.data
        document.getElementById("imdb").innerHTML = result.IMDb
        document.getElementById("views").innerHTML = ` <i style="font-size: 17px;" class="ti-eye" > </i> ` + result.view
        document.getElementById("like").innerHTML = ` <i onclick="like('${result._id}')" style="font-size: 17px;" class="ti-thumb-up" > </i> ` + result.like
        document.getElementById("dislike").innerHTML = ` <i onclick="dislike('${result._id}')"  style="font-size: 17px;"  class="ti-thumb-down" > </i> ` + result.dislike
        document.getElementById("name").innerHTML = result.name
        document.getElementById("rating").innerHTML = `
                            <i onclick="ratingKino('${result._id}', 1)" class="ti-star text-white"></i>
                            <i onclick="ratingKino('${result._id}', 2)" class="ti-star text-white"></i>
                            <i onclick="ratingKino('${result._id}', 3)" class="ti-star text-white"></i>
                            <i onclick="ratingKino('${result._id}', 4)" class="ti-star text-white"></i>
                            <i onclick="ratingKino('${result._id}', 5)" class="ti-star text-white"></i>
                            <span class="tag ml-3" >${result.rating}</span>
        `
        document.getElementById("hd").innerHTML = result.format
        document.getElementById("age").innerHTML = result.age.name
        document.getElementById("times").innerHTML = ` <i style="font-size:17px;" class="ti-timer" > </i> ` + result.videoTime
        document.getElementById("description").innerHTML = result.description
        document.getElementById("images").style.backgroundImage = `url(/uploads/${result.files[1]})`
        document.getElementById("watching").href = `/watch_movie/${id}`

        const country = $('#country')
        await country.html("")
        result.country.forEach((item) => {
            country.append(`<li>${item.name}</li>`)
        });

        const janr = $('#janr')
        await janr.html("")
        result.janr.forEach((item) => {
            janr.append(`<li>${item.name}</li>`)
        });

        const language = $('#language')
        await language.html("")
        result.language.forEach((item) => {
            language.append(`<li>${item.name}</li>`)
        });

        const category = $('#category')
        await category.html("")
        result.category.forEach((item) => {
            category.append(`<li>${item.name}</li>`)
        });

        const author = $('#author')
        await author.html("")
        result.author.forEach((item) => {
            author.append(`<li>${item.name}</li>`)
        });

        const tag = $('#tag')
        await tag.html("")
        result.tag.forEach((item) => {
            tag.append(`<li>${item.name}</li>`)
        });
    })


    const sendComment = () => {
        const name = document.getElementById('username').value
        const message = document.getElementById('message').value
        const error_create = document.getElementById('error_create')
        const success_create = document.getElementById('success_create')
        if (
            name == "" || message == ""
        ) {
            error_create.style.display = "block"
            setTimeout(() => {
                error_create.style.display = "none"
            }, 2000)
        } else {
            axios.post('/api/comment/kino', {
                name: name,
                message: message,
                kino: id
            })
                .then((res) => {
                    success_create.style.display = "block"
                    setTimeout(() => {
                        window.location.reload()
                    }, 2000)
                })
                .catch((error) => {
                    console.log(error)
                })
        }
    }


    axios.get(`/api/comment/kino/${id}`).then(async (res) => {
        const result = res.data
        console.log(result)
        const allComment = $('.allComment')
        await allComment.html("")
        result.forEach((element) => {
            allComment.append(`
                    <div class="col-lg-8 offset-2 mt-3" >
                        <div class="user-avater">
                            <div style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                                <img style="border-radius: 50%; width:80px; "  src="/images/team6.jpg" alt="user">
                                <h4>${element.name}</h4>
                                <h4>
                                    <span class="tag mr-4">
                                        <b><i onclick="likeComment()" style="font-size: 20px;"
                                                class="ti-thumb-up text-success"> </i> 0 </b>
                                    </span>
                                    <span class="tag">
                                        <b> <i onclick="dislikeComment()" style="font-size: 20px;"
                                                class="ti-thumb-down text-danger"> </i> 0</b>
                                    </span>
                                </h4>
                                <h4>${new Date(element.createdAt).toLocaleString()}</h4>
                                
                            </div>
                            <div class="p-3">
                                <p>${element.message}</p>
                                <a href="/comment/${element._id}"  style="cursor: pointer;" class="btn btn-success text-white"> Javob qaytarish</a>
                                <a href="/comment/${element._id}"  style="cursor: pointer;" class="btn btn-success text-white"> Batafsil</a>
                            </div>
                        </div>
                    </div>
            `)
        });
    })






</script>